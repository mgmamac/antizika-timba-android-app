<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title></title>

    <link href="lib/ionic/css/ionic.css" rel="stylesheet" />
    <link href="css/angular-chart.css" rel="stylesheet" />
    <link href="lib/angular-material/angular-material.min.css" rel="stylesheet"  />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />

    <!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
    <link href="css/ionic.app.css" rel="stylesheet">
    -->

    <!-- ionic/angularjs js -->
    <script src="lib/ionic/js/ionic.bundle.js"></script>

    <!-- cordova script (this will be a 404 during development) -->
    <script src="cordova.js"></script>

    <!-- Libraries -->
    <script src="lib/Chart.js"></script>
    <script src="lib/angular-chart.min.js"></script>
    <script src="lib/moment/moment.js"></script>
    <script src="lib/angular-moment/angular-moment.js"></script>
    <script src="lib/angular-animate/angular-animate.js"></script>
    <script src="lib/angular-aria/angular-aria.min.js"></script>
    <script src="lib/angular-material/angular-material.min.js"></script>
    <!-- Angular modules & controllers -->
    <script src="js/app.js"></script>
    
    <script type="text/javascript">
      function showSideMenu(){
        document.getElementById("sideMenu").className="sideMenu showSideMenu";
        document.getElementById("pane").className="pane hidePane";
        document.getElementById("pane").style.pointerEvents="none";
      }

      function hideSideMenu(){
        document.getElementById("sideMenu").className="sideMenu hideSideMenu";
        document.getElementById("pane").className="pane showPane";
        document.getElementById("pane").style.pointerEvents="auto";
      }

      function waterLevelIconPositive(){
        document.getElementById("waterLevelIcon").className="icon ion-checkmark-circled positive";
      }

      function waterLevelIconNegative(){
        document.getElementById("waterLevelIcon").className="icon ion-android-alert assertive";
      }

      function daysIconPositive(){
        document.getElementById("daysIcon").className="icon ion-checkmark-circled positive";
      }

      function daysIconNegative(){
        document.getElementById("daysIcon").className="icon ion-android-alert assertive";
      }

      function statusIconPositive(){
        document.getElementById("statusIcon").className="icon ion-checkmark-circled positive";
      }

      function statusIconNegative(){
        document.getElementById("statusIcon").className="icon ion-android-alert assertive";
      }

      function setDeviceId(id){
        document.getElementById("deviceId").innerHTML="Device ID: "+id;
      }

      function setWaterLevel(prcnt){

        document.getElementById("waterLevel").innerHTML="&nbspWater Level: "+prcnt.toString()+"%";

        if(prcnt>=80){
          waterLevelIconNegative();
        }
        else{
          waterLevelIconPositive();
        }
      }

      function setDays(num){
        if(num<=1){
          document.getElementById("days").innerHTML="&nbspDays Without Replacing: "+num.toString()+"Day";
        }
        else{
          document.getElementById("days").innerHTML="&nbspDays Without Replacing: "+num.toString()+"Days";
        }

        if(num<=2){
          daysIconPositive();
        }
        else{
          daysIconNegative();
        }
      }

      function setStatus(prcnt, num){
        var str;

        str="&nbspStatus: ";

        if(prcnt<50){
          str+="The water level is less than 50%. ";
        }
        else if(prcnt<75){
          str+="The water level is less than 75%. ";
        }
        else if(prcnt<100){
          str+="The container is nearly full. ";
        }
        else{
          str+="The container is full. Reduce water to prevent overflow. ";
        }

        if(days<=2){
          str+="The water is of good condition.";
        }
        else{
          str+="Please replace the stagnant water.";
        }
        
        if(prcnt>=80 || num>=3){
          statusIconNegative();
        }
        else{
          statusIconPositive();
        }
      }
    </script>
  </head>
  <body ng-app="starter">
    <div class="sideMenu" id="sideMenu">
      <div class="bar bar-header bar-positive" style="position: relative;">
        <button class="button button-icon icon ion-chevron-left" onclick="hideSideMenu()"></button>
        <h1 class="title">Menu</h1>
      </div>

      <ul class="list">
        <a class="item" href="index.html">
          <i class="icon ion-home"></i>
          Home
        </a>

        <a class="item" href="about.html">
          <i class="icon ion-information-circled"></i>
          About
        </a>
      </ul>
    </div>

    <ion-pane id="pane" class="pane">
      <ion-header-bar class="bar bar-header bar-positive">
        <button class="button button-icon icon ion-navicon-round" onclick="showSideMenu()"></button>
        <h1 class="title">CS 145 Best Capstone Project</h1>
      </ion-header-bar>

      <ion-content ng-controller="WaterHistoryController">
        <md-card>
          <md-card-content>
          <h2 class="md-display-1 id-label">{{ device.nickname || "Device " + device._id }}</h2>
          <p><b>Last Reading: </b>{{ levels[0][levels[0].length - 1] }} cm ({{ percentage }} %), <span am-time-ago="device.lastReading"></span></p>
          <p><b>Last Emptied </b><span am-time-ago="device.lastEmptied"></span></p>
          <p><b>Maximum Capacity: </b>{{ device.maxCapacity }} cm</p>
          <p><md-icon md-svg-icon="{{ (device.receiveFrom) ? 'check-circle' : 'close-circle' }}"></md-icon>{{ (device.receiveFrom) ? "Receiving sensor readings" : "Readings from this device are not being recorded" }}</p>
          <p ng-show="isStagnant"><md-icon md-svg-icon="alert-box"></md-icon>Stagnant</p>
          <p ng-show="isFull"><md-icon md-svg-icon="alert-octagon"></md-icon>Container is Full ({{ percentage }} %)</p>
          
          <md-button class="md-raised" ng-click="getDevice()">
            <md-icon md-svg-icon="refresh"></md-icon>Refresh
            <md-tooltip>Retrieve latest sensor data</md-tooltip> 
          </md-button>
          
          
          <h3 class="title">Latest sensor readings</h3>
          <canvas id="line" class="chart chart-line" chart-data="levels"
          chart-labels="labels" chart-series="series">
          </canvas> 
          </md-card-content>
        </md-card>
      </ion-content>
    </ion-pane>
  </body>
</html>
